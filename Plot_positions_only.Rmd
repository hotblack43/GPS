---
title: "Plot positions and speeds"
output: 
  pdf_document: 
    fig_height: 9
---


Plots the GPS poistions as eastings and northings on a map.

Reads .xlsx files
Outputs .rds files for columns not all NA

```{r}
rm(list=ls())
setwd("~/WORKSHOP/GPS/")
library(dplyr)
library(lubridate)
library(MASS)
library(dsm)

Rearth <- 6371*1e3 # meters

```

# 










# read and plot each file
```{r,fig.width=6,fig.height=9}
files <- c('OUTPUT/Mallemuk.rds','OUTPUT/Soekonge.rds','OUTPUT/Ismaage.rds','OUTPUT/Havterne.rds','OUTPUT/Havoern.rds','OUTPUT/Edder.rds')
#files <- files[1]
# list the important times - start, jumps, ending:
important_times <- c(as.POSIXct("2022-03-31 00:00:00",tz="UTC"),as.POSIXct("2022-04-7 00:00:00",tz="UTC"),
                     as.POSIXct("2022-04-24 12:00:00",tz="UTC"),as.POSIXct("2022-04-27 17:00:00",tz="UTC"),
                     as.POSIXct("2022-05-04 00:00:00",tz="UTC"),as.POSIXct("2022-05-31 00:00:00",tz="UTC"))
limitdates <- NULL
for (it in 1:(length(important_times)-1))
{
  limitdates <- c(limitdates,c(important_times[it],important_times[it+1]))
}

for (ifil in 1:length(files))
{
  name <- files[ifil]
  print("------------------------------------------")
  print(paste(" Processing file ",name))
  
  statname <- strsplit(strsplit(name, "/")[[1]][2],".rds")[[1]][1]
  df <- readRDS(files[ifil])
  df <- df[,c("Longitude","Latitude","POSIX")]
  df <- na.omit(df)
  xy <- latlong2km(df$Longitude, df$Latitude)
  
  plot(xy$km.e*1000,xy$km.n*1000,asp=1,main=statname,type="b",pch=19,cex=0.3,xlab="meters East-West",ylab="meters North-South")
  png(paste0("FIGURES/map_",statname,'.png'))
  plot(xy$km.e*1000,xy$km.n*1000,asp=1,main=statname,type="b",pch=19,cex=0.3,xlab="meters East-West",ylab="meters North-South")
  dev.off()    
}
print("------------------------------------------")
```


